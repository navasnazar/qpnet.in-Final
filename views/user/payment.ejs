<!DOCTYPE html>
<!-- Html start -->
<html lang="en">
  <!-- Head Start -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="oslo" />
    <meta name="keywords" content="oslo" />
    <meta name="author" content="oslo" />
    <link rel="icon" href="../assets/images/favicon/favicon.png" type="image/x-icon" />
    <link rel="shortcut icon" href="../assets/images/favicon/favicon.png" type="image/x-icon" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="icon" href="../assets/images/favicon/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="../assets/images/favicon/favicon.png" />
    <meta name="theme-color" content="#0f8fac" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Oslo" />
    <meta name="msapplication-TileImage" content="../assets/images/favicon/favicon.png" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <title>Oslo | Payment</title>

    <!-- Google Jost Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Google Monsterrat Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&display=swap" rel="stylesheet" />

    <!-- Google Leckerli Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Leckerli+One&display=swap" rel="stylesheet" />

    <!-- Bootstrap Css -->
    <link id="rtl-link" rel="stylesheet" type="text/css" href="../assets/css/vendors/bootstrap.css" />

    <!-- Style Css -->
    <link id="change-link" rel="stylesheet" type="text/css" href="../assets/css/style.css" />
  </head>
  <!-- Head End -->

  <!-- Body Start -->
  <body>
    <!-- Loader Start -->
    <div class="loader-wrapper">
      <div class="loader animate">
        <!-- <span>O</span>
        <span>S</span>
        <span>L</span>
        <span>O</span> -->
      </div>
    </div>
    <!-- Loader End -->

    <!-- Overlay -->
    <a href="javascript:void(0)" class="overlay-general"></a>
    <!-- Header Start -->
    <%- include('../partials/user-header.ejs') %> 
    <!-- Header End -->

    <!-- Main Start -->
    <main class="main">
      <!-- Breadcrumb Start -->
      <div class="breadcrumb-wrap">
        <div class="banner">
          <img class="bg-img bg-top" src="../assets/images/inner-page/banner-p.jpg" alt="banner" />

          <div class="container-lg">
            <div class="breadcrumb-box">
              <div class="heading-box">
                <h1>Checkout</h1>
              </div>
              <ol class="breadcrumb">
                <li><a href="/">Home</a></li>
                <li>
                  <a href="javascript:void(0)"><i data-feather="chevron-right"></i></a>
                </li>
                
                <li>
                  <a href="javascript:void(0)"><i data-feather="chevron-right"></i></a>
                </li>
                <li><a href="/cart">Cart</a></li>
                <li>
                  <a href="javascript:void(0)"><i data-feather="chevron-right"></i></a>
                </li>
                <li class="current"><a href="/address">Checkout</a></li>
              </ol>
            </div>
          </div>
        </div>
      </div>
      <!-- Breadcrumb End -->

      <!-- Checkout Section Start -->
      <section class="checkout">
        <div class="container-lg">
          <div class="row g-4 g-md-3 g-xxl-5 cart">
            <div class="col-md-7 col-lg-8 col-xl-9">
              <div class="title-box2">
                <h2 class="heading-2">Payment Options</h2>
                <!-- <button class="btn-outline btn-sm btn" data-bs-toggle="modal" data-bs-target="#addNewcard">Add Card</button> -->
              </div>
<!-- Payment Section Start -->
  <div class="payment-section">
    <div class="accordion" id="accordionExample">
<form  id="checkout-form"  >
  <% if(addressId){ %> 
      <input type="text" id="addressType" name="addressType" hidden value="<%= addressId %> ">
  <% } %>                  
<!-- Accordion Start -->
<div class="accordion-item">
  <h2 class="accordion-header" id="headingOne">
    <button class="accordion-button font-md title-color" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
      Select Payment Option <span><i data-feather="chevron-right"></i></span>
    </button>
  </h2>
  <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
    <div class="accordion-body">
      <div class="row g-3 filter-row">
        <div class="col-sm-6 col-md-12 col-lg-6">
          <div class="filter-col radio-box">
            <input class="radio-input" checked type="radio" name="paymentMethod" id="card1" value="razorpay" />
            <label class="radio-label content-color" for="card1"
              ><span class="font-md"> RazorPay <img style="width: 100px; height: 30px;" class="payment-card" src="../assets/icons/png/razorpay.png" alt="card" /> </span
            ></label>
          </div>
        </div>

        <div class="col-sm-6 col-md-12 col-lg-6">
          <div class="filter-col radio-box">
            <input class="radio-input" type="radio" name="paymentMethod" id="card2" value="paypal" />
            <label class="radio-label content-color" for="card2">
              <span class="font-md"> PayPal <img style="width: 100px; height: 30px;" class="payment-card" src="../assets/icons/png/paypal.png" alt="card" /> </span
            ></label>
          </div>
        </div>

        <div class="col-sm-6 col-md-12 col-lg-6">
          <div class="filter-col radio-box">
            <input class="radio-input" type="radio" name="paymentMethod" id="card3" value="cod" />
            <label class="radio-label content-color" for="card3">
              <span class="font-md">
                Cash on Delivery <img style="width: 100px; height: 30px;" class="payment-card discovery" src="../assets/icons/png/cod.png" alt="card" />
                <img class="payment-card discovery-w" src="../assets/icons/png/discover-w.png" alt="card" />
              </span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Accordion End -->
      
                </div>
              </div>
              <!-- Payment Section End -->
            </div>

            <div class="col-md-5 col-lg-4 col-xl-3">
              <div class="summery-wrap">
                
                <div class="cart-wrap grand-total-wrap">
                  <div>
                    <div class="order-summery-box">
                      <h5 class="cart-title">Price Details (<%= cartLength %>  Items)</h5>
                      <ul class="order-summery">
                        <li>
                          <span>Bag total</span>
                          <span>₹ <%= userCart[0].finalAmount %> </span>
                        </li>

                        <li>
                          <span>Coupon Discount</span>
                          <span>- ₹ <%= userCart[0].couponOffer %> </span>
                        </li>

                        <li>
                          <span>Delivery</span>
                          <span>₹ <%= userCart[0].deliveryCost %></span>
                        </li>

                        <li class="pb-0">
                          <span>Total Amount</span>
                          <span>₹ <%= userCart[0].checkoutAmount %></span>
                        </li>
                      </ul>
                      <div class="row g-3 mt-2">
                        <div class="col-6 col-md-12">
                          <button type="submit" class="btn-solid checkout-btn">Place Order</button>
                          <!-- <a href="order-success.html" class="btn-solid checkout-btn">Place Order <i class="arrow"></i></a> -->
                        </form>
                        </div>
                        <div class="col-6 col-md-12">
                          <a href="/" class="btn-outline w-100 justify-content-center checkout-btn"> Back To Shop </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- Checkout Section End -->
    </main>
    <!-- Main End -->

    <!-- Document Footer Start -->
    <footer class="footer-document ratio_asos mb-xxl">
      <div class="bg-footer-l">
        <img src="../assets/images/fashion/banner/bg-footer-l.png" alt="banner" />
      </div>
      <div class="bg-footer-r">
        <img src="../assets/images/fashion/banner/bg-footer-r.png" alt="banner" />
      </div>
      <div>
        <div class="container-lg">
          <div class="main-footer">
            <div class="row gy-3 gy-md-4 gy-xl-0">
              <div class="col-xl-3 col-lg-4 col-md-6">
                <div class="content-box">
                  <img class="logo" src="../assets/images/logos/logo-w.png" alt="logo-white" />
                  <ul>
                    <li><i data-feather="map-pin"></i> <span> 1418 Riverwood Drive, Suite 3245 Cottonwood, CA 96052, United States </span></li>
                    <li>
                      <i data-feather="phone"></i><a class="nav" href="tel:185659635"><span> + 185659635 </span></a>
                    </li>
                    <li>
                      <i data-feather="mail"></i><a class="nav" href="mailto:fashion098@gmail.com"><span> fashion098@gmail.com </span></a>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="nav-footer col-lg-2 col-md-4 order-md-3 order-lg-2">
                <div class="nav content-box d-md-block">
                  <h5 class="heading-footer">Shop By</h5>
                  <ul>
                    <li><a class="nav" href="javascript:void(0)">New In </a></li>
                    <li><a class="nav" href="javascript:void(0)">Women </a></li>
                    <li><a class="nav" href="javascript:void(0)">Men </a></li>
                    <li><a class="nav" href="javascript:void(0)">Shoes</a></li>
                    <li><a class="nav" href="javascript:void(0)">Bags & Accessories </a></li>
                    <li><a class="nav" href="javascript:void(0)">Top Brands </a></li>
                  </ul>
                </div>
              </div>

              <div class="nav-footer col-xl-2 col-lg-3 col-md-4 order-md-4 order-lg-3">
                <div class="nav d-md-block content-box">
                  <h5 class="heading-footer">Information</h5>
                  <ul>
                    <li><a class="nav" href="index.html">Home </a></li>
                    <li><a class="nav" href="shop-left-sidebar.html">Shop </a></li>
                    <li><a class="nav" href="about-us.html">About Us</a></li>
                    <li><a class="nav" href="blog-detail.html">Blog </a></li>
                    <li><a class="nav" href="contact-us.html">Contact </a></li>
                  </ul>
                </div>
              </div>

              <div class="nav-footer col-xl-2 col-lg-3 col-md-4 order-md-5 order-lg-4">
                <div class="nav d-md-block content-box">
                  <h5 class="heading-footer">Get Help</h5>
                  <ul>
                    <li><a class="nav" href="javascript:void(0)">Your </a></li>
                    <li><a class="nav" href="javascript:void(0)">Orders </a></li>
                    <li><a class="nav" href="javascript:void(0)">Your </a></li>
                    <li><a class="nav" href="javascript:void(0)">Account</a></li>
                    <li><a class="nav" href="javascript:void(0)">Track </a></li>
                    <li><a class="nav" href="javascript:void(0)">Orders</a></li>
                  </ul>
                </div>
              </div>

              <div class="col-xl-3 col-md-6 col-lg-4 order-md-2 order-lg-5">
                <div class="content-box">
                  <h5 class="heading-footer">Follow Us</h5>
                  <div class="follow-wrap">
                    <ul>
                      <li>
                        <a href="javascript:void(0)"> <img src="../assets/icons/svg/social/fb.svg" alt="fb" /> </a>
                      </li>
                      <li>
                        <a href="javascript:void(0)"> <img src="../assets/icons/svg/social/inta.svg" alt="fb" /> </a>
                      </li>
                      <li>
                        <a href="javascript:void(0)"> <img src="../assets/icons/svg/social/tw.svg" alt="fb" /> </a>
                      </li>
                      <li>
                        <a href="javascript:void(0)"> <img src="../assets/icons/svg/social/pint.svg" alt="fb" /> </a>
                      </li>
                    </ul>
                  </div>

                  <div class="subscribe-box">
                    <h5>Newsletter Sign Up</h5>
                    <p>Receive our latest updates about our products & promotions.</p>
                  </div>

                  <form action="javascript:void(0)" class="footer-form">
                    <input required type="email" class="form-control" placeholder="Your email address" />
                    <button type="submit" class="btn-solid">SUBMIT <i class="arrow"></i></button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div class="sub-footer">
            <div class="row gy-3">
              <div class="col-md-6">
                <ul>
                  <li>
                    <a href="javascript:void(0)"> <img src="../assets/icons/png/1.png" class="img-fluid blur-up lazyload" alt="payment icon" /></a>
                  </li>
                  <li>
                    <a href="javascript:void(0)"> <img src="../assets/icons/png/2.png" class="img-fluid blur-up lazyload" alt="payment icon" /></a>
                  </li>
                  <li>
                    <a href="javascript:void(0)"> <img src="../assets/icons/png/3.png" class="img-fluid blur-up lazyload" alt="payment icon" /></a>
                  </li>
                  <li>
                    <a href="javascript:void(0)"> <img src="../assets/icons/png/4.png" class="img-fluid blur-up lazyload" alt="payment icon" /></a>
                  </li>
                </ul>
              </div>
              <div class="col-md-6">
                <p class="mb-0">© 2022, OSLO Template. Made with heart by Pixelstrap</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Document Footer End -->

    <!-- Mobile Menu Footer Start -->
    <footer class="mobile-menu-footer d-sm-none">
      <ul>
        <li>
          <a href="index.html">
            <i data-feather="home"></i>
            <span>Home</span>
          </a>
        </li>
        <li>
          <a href="search.html" class="search-link">
            <i data-feather="search"></i>
            <span>Search</span>
          </a>
        </li>
        <li>
          <a href="cart.html">
            <i data-feather="shopping-bag"></i>
            <span>Cart</span>
          </a>
        </li>
        <li>
          <a href="wishlist.html">
            <i data-feather="heart"></i>
            <span>Wishlist</span>
          </a>
        </li>
        <li>
          <a href="user-dashboard.html">
            <i data-feather="user"></i>
            <span>Account</span>
          </a>
        </li>
      </ul>
    </footer>
    <!-- Mobile Menu Footer End -->

    
    <!-- Add Card Modal End -->

    <!-- Tap To Top Button Start -->
    <div class="tap-to-top-box hide">
      <button class="tap-to-top-button"><i data-feather="chevrons-up"></i></button>
    </div>
    <!-- Tap To Top Button End -->


<!-- payment options start -->

<script>
  $("#checkout-form").submit((e)=>{
    console.log("ajax working")
    e.preventDefault()  
    $.ajax({
      url:'/placeOrder',
      method:'post',
      data:$('#checkout-form').serialize(),
      success:(response)=>{
        alert("Are you sure to proceed")  
        console.log("The response")
        if(response.codSuccess){
       console.log("COD working")
       location.replace('/OrderPaymentSucess?id=Cash_on_Delivery')
          // window.open('/userhome/success')
        }else if(response.razorpay){
          console.log("online working")
          razorpayPayment(response.order)
        }else if(response.paypal){
        console.log("calling the paypal")
       paypalPayment(response.ChOutAmnt,response.orderid)
        } 
      }
    })
  })




function paypalPayment(ChOutAmnt, orderid){
console.log("calling the paypal")
console.log(ChOutAmnt)
$.ajax({
url:'/paypal_payment',

data:{
totalPrice: ChOutAmnt,
orderId:orderid,  
},
method:'post',
success:(response)=>{
console.log(response)
location.href=response.forwardLink
 if(response.status){
    location.href='/orderSuccess'
}else{
  alert("payment faild")
} 
}
})
}
  
      
  function razorpayPayment(order){
    console.log(order)
  var options = {
      "key": "rzp_test_8uymMw1v38kcUM", // Enter the Key ID generated from the Dashboard
      "amount":order.amount , // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
      "currency": "INR",
      "name": "NaNaShoppi",
      "description": "Test Transaction",
      "image": "/images/logo.png",
      "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
      "handler": function (response){
          RazoverifyPayment(response,order)
      },
      "prefill": {
          "name": "NaNaShoppi",
          "email": "nanashoppi@gmail.com",
          "contact": "+91 9567819494"
      },
      "notes": {
          "address": "NaNa Shoppi LTD"
      },
      "theme": {
          "color": "#3399cc"
      }
  }
  var rzp1 = new Razorpay(options);
  rzp1.open();
  }
  function RazoverifyPayment(payment,order){
    location.replace('/OrderPaymentSucess?id=RazorPay')

    $.ajax({
      url:'/userhome/razo-verify-payment',
      data:{
        payment,
        order
      },
      method:'post',
      success:(response)=>{
        if(response.status){
          console.log("succes")
            location.href='/orderSuccess'
        }else{
         // need to render payment faild page
           location.reload()
          alert("payment faild")
        }
      }
    })
  }


  </script>
  

<!-- payment options end -->



    <!-- Bootstrap Js -->
    <script src="../assets/js/bootstrap/bootstrap.bundle.min.js"></script>

    <!-- Feather Icon -->
    <script src="../assets/js/feather/feather.min.js"></script>

    <!-- Header Sticky js  -->
    <script src="../assets/js/sticky-header.js"></script>

    <!-- Script Js -->
    <script src="../assets/js/script.js"></script>
  </body>
  <!-- Body End -->
</html>
<!-- Html End -->
